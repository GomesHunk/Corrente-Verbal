<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corrente Verbal - Início</title>
    <link rel="stylesheet" href="/static/style.css">
    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js" integrity="sha384-+fv93K7xKq4yqIQp3lHzuFhgr9gU0CggE2m0bA8D7pKvhSukP3iMNI5JmYzoZ6Zt" crossorigin="anonymous"></script>
</head>

<body class="min-h-full bg-slate-50 text-slate-800">
    <div class="max-w-4xl mx-auto px-4 py-8">
        <header class="flex items-center justify-between mb-8">
            <h1 class="text-3xl font-bold">Corrente Verbal</h1>
            <div class="flex items-center gap-2">
                <label for="themeSelect" class="text-sm">Tema</label>
                <select id="themeSelect" class="rounded-md border px-2 py-1 text-sm">
                    <option value="sun">Claro</option>
                    <option value="moon">Escuro</option>
                    <option value="matrix">Matrix</option>
                    <option value="starwars">Star Wars</option>
                    <option value="strangerthings">Stranger Things</option>
                    <option value="flamengo">Flamengo</option>
                    <option value="fluminense">Fluminense</option>
                    <option value="botafogo">Botafogo</option>
                    <option value="vasco">Vasco</option>
                </select>
            </div>
        </header>

        <main class="grid md:grid-cols-2 gap-8">
            <section class="bg-white rounded-xl shadow p-6">
                <h2 class="text-xl font-semibold mb-4">Criar sala</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm mb-1" for="nomeCriador">Seu nome</label>
                        <input id="nomeCriador" type="text" maxlength="20" class="w-full rounded-md border px-3 py-2"
                            placeholder="Ex: Ana" />
                    </div>
                    <div>
                        <label class="block text-sm mb-1" for="numPalavras">Palavras por jogador</label>
                        <input id="numPalavras" type="number" min="3" max="10" value="5"
                            class="w-full rounded-md border px-3 py-2" />
                    </div>
                    <div>
                        <label class="block text-sm mb-1" for="maxJogadores">Máximo de jogadores</label>
                        <input id="maxJogadores" type="number" min="2" max="10" value="10"
                            class="w-full rounded-md border px-3 py-2" />
                    </div>
                    <div>
                        <label class="block text-sm mb-1" for="modoJogo">Modo de jogo</label>
                        <select id="modoJogo" class="w-full rounded-md border px-3 py-2">
                            <option value="classico">Clássico</option>
                            <option value="cooperativo">Cooperativo</option>
                            <option value="duelo">Duelo</option>
                            <option value="relampago">Relâmpago</option>
                        </select>
                        <p class="text-xs text-slate-500 mt-1" id="descricaoModo">
                          Clássico: cada um escreve palavras, adivinha na sua vez. Mais flexível e descontraído.
                        </p>
                    </div>
                    <button id="btnCriar"
                        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white rounded-md py-2 font-medium">
                        Criar sala
                    </button>
                </div>
            </section>

            <section class="bg-white rounded-xl shadow p-6">
                <h2 class="text-xl font-semibold mb-4">Entrar em sala</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm mb-1" for="nomeJogador">Seu nome</label>
                        <input id="nomeJogador" type="text" maxlength="20" class="w-full rounded-md border px-3 py-2"
                            placeholder="Ex: João" />
                    </div>
                    <div>
                        <label class="block text-sm mb-1" for="codigoSala">Código da sala</label>
                        <input id="codigoSala" type="text" class="w-full rounded-md border px-3 py-2 uppercase"
                            placeholder="ABC123" />
                    </div>
                    <button id="btnEntrar"
                        class="w-full bg-slate-800 hover:bg-slate-900 text-white rounded-md py-2 font-medium">
                        Entrar
                    </button>
                </div>
            </section>
        </main>

        <section class="mt-10 bg-white rounded-xl shadow p-6">
            <h3 class="text-lg font-semibold mb-2">Como jogar</h3>
            <ol class="list-decimal pl-6 space-y-1 text-sm">
                <li>Crie uma sala, escolha o modo e compartilhe o código com seus amigos.</li>
                <li>Cada jogador digita suas palavras. O criador inicia a partida quando todos estiverem prontos.</li>
                <li>Na sua vez, dê dicas para seu alvo adivinhar as palavras dentro do tempo.</li>
                <li>Experimente modos como Cooperativo, Duelo e Relâmpago para variações divertidas.</li>
            </ol>
        </section>
    </div>

    <script>
        const socket = io();

        // Tema
        const themeSelect = document.getElementById('themeSelect');
        function applyTheme(theme) {
          document.documentElement.setAttribute('data-theme', theme);
          localStorage.setItem('theme', theme);
        }
        const savedTheme = localStorage.getItem('theme') || 'sun';
        themeSelect.value = savedTheme;
        applyTheme(savedTheme);
        themeSelect.addEventListener('change', (e) => applyTheme(e.target.value));

        // PlayerId persistente
        function ensurePlayerId() {
          let pid = localStorage.getItem('playerId');
          if (!pid) {
            pid = 'p_' + Math.random().toString(36).slice(2) + Date.now().toString(36);
            localStorage.setItem('playerId', pid);
          }
          return pid;
        }

        // Descrição dinâmica do modo
        const modoJogoEl = document.getElementById('modoJogo');
        const descricaoModoEl = document.getElementById('descricaoModo');
        const descricoes = {
          classico: 'Clássico: cada um escreve palavras, adivinha na sua vez. Mais flexível e descontraído.',
          cooperativo: 'Cooperativo: todos contra o tempo, objetivo comum.',
          duelo: 'Duelo: 1x1 com rodadas rápidas.',
          relampago: 'Relâmpago: partidas curtas e intensas.'
        };
        modoJogoEl.addEventListener('change', () => {
          descricaoModoEl.textContent = descricoes[modoJogoEl.value] || '';
        });

        // Criar sala
        document.getElementById('btnCriar').addEventListener('click', () => {
          const nome = document.getElementById('nomeCriador').value.trim();
          const num_palavras = parseInt(document.getElementById('numPalavras').value, 10) || 5;
          const max_jogadores = parseInt(document.getElementById('maxJogadores').value, 10) || 10;
          const modo = document.getElementById('modoJogo').value;
          if (!nome) { alert('Informe seu nome'); return; }

          const player_id = ensurePlayerId();
          socket.emit('criar_sala', { nome, num_palavras, max_jogadores, modo, player_id });
        });

        socket.on('sala_criada', (data) => {
          const codigo = data.codigo;
          const nome = data.nome;
          window.location.href = `/sala/${codigo}?nome=${encodeURIComponent(nome)}`;
        });

        socket.on('erro', (e) => alert(e.msg || 'Erro'));

        // Entrar na sala
        document.getElementById('btnEntrar').addEventListener('click', () => {
          const nome = document.getElementById('nomeJogador').value.trim();
          const sala = document.getElementById('codigoSala').value.trim().toUpperCase();
          if (!nome || !sala) { alert('Informe nome e código'); return; }
          const player_id = ensurePlayerId();
          socket.emit('entrar_na_sala', { nome, sala, player_id });
        });

        socket.on('jogador_entrou', (data) => {
          if (data && data.codigo) return; // ignore on home
        });
    </script>
</body>

</html>
